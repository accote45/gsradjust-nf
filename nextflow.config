/*
 * GSR-Adjust Pipeline Configuration
 */

// ============================================================================
// Manifest
// ============================================================================

manifest {
    name = 'gsradjust-nf'
    author = 'Your Name'
    homePage = 'https://github.com/yourusername/gsradjust-nf'
    description = 'Tool-agnostic Gene Set Randomization adjustment for pathway enrichment'
    mainScript = 'main.nf'
    version = '1.0.0'
    nextflowVersion = '>=21.04.0'
}

// ============================================================================
// Default Parameters
// ============================================================================

params {
    // Core parameters (can be overridden via command line)
    gmt_file = null
    adapter = null
    adapter_config = null
    num_random_sets = 1000
    outdir = "results"
    
    // Resource defaults
    max_cpus = 4
    max_memory = '16.GB'
    max_time = '24.h'
}

// ============================================================================
// Process Configuration
// ============================================================================

process {
    // Default resources for all processes
    cpus = 1
    memory = 4.GB
    time = 2.h
    
    errorStrategy = 'retry'
    maxRetries = 2
    
    // Process-specific resources
    withName: generate_birewire_gmts {
        cpus = 1
        memory = 8.GB
        time = 4.h
    }
    
    withName: run_adapter {
        cpus = 2
        memory = 8.GB
        time = 6.h
    }
    
    withName: calc_empirical {
        cpus = 1
        memory = 4.GB
        time = 2.h
    }
}

// ============================================================================
// Executor Configuration
// ============================================================================

executor {
    name = 'local'
    cpus = params.max_cpus
    memory = params.max_memory
}

// ============================================================================
// Profile Configuration
// ============================================================================

profiles {
    // Standard local execution
    standard {
        executor.name = 'local'
    }
    
    // Example: LSF cluster
    lsf {
        process.executor = 'lsf'
        process.queue = 'normal'
        process.clusterOptions = '-P your_project_code'
    }
    
    // Example: SLURM cluster
    slurm {
        process.executor = 'slurm'
        process.queue = 'normal'
    }
    
    // Docker execution
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
    }
    
    // Singularity execution
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
    }
    
    // Testing profile (reduced resources)
    test {
        params.num_random_sets = 10
        process.memory = 2.GB
        process.time = 30.m
    }
}

// ============================================================================
// Reporting
// ============================================================================

timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_info/report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/dag.svg"
}

// ============================================================================
// Other Settings
// ============================================================================

// Enable resume by default
resume = true

// Work directory for intermediate files
workDir = './work'

// Clean up work directory on successful completion
cleanup = false
